<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Snow Checklist iPhone Compatible</title>

<style>
  body {
    margin: 0;
    background: #000;
    overflow-x: hidden;
    font-family: Arial, sans-serif;
    color: white;
    padding-bottom: 120px;
  }

  /* Snowflakes */
  .snowflake {
    position: fixed;
    top: -10px;
    color: white;
    font-size: 1rem;
    user-select: none;
    pointer-events: none;
    animation-name: fall;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    z-index: 0;
  }

  @keyframes fall { to { transform: translateY(110vh); } }

  /* Checklist container */
  #list-container { padding: 20px; position: relative; z-index: 10; }

  .item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    font-size: 1.2rem;
  }

  .item input { margin-right: 10px; transform: scale(1.4); }
  .item button {
    margin-left: auto;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 1rem;
    background: #f44336;
    color: white;
    border: none;
    border-radius: 5px;
  }

  /* Add bar */
  #add-area {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(30,30,30,0.9);
    padding: 15px;
    display: flex;
    gap: 10px;
    z-index: 20;
  }

  #newItem { flex: 1; padding: 10px; font-size: 1.1rem; }
  #addBtn, #shareBtn {
    padding: 10px 15px;
    font-size: 1.1rem;
    cursor: pointer;
  }
  #shareBtn { background: #3fa9f5; color: white; border: none; border-radius: 5px; }
</style>
</head>
<body>

<div id="list-container"></div>

<div id="add-area">
  <input id="newItem" type="text" placeholder="Add new item...">
  <button id="addBtn">Add</button>
  <button id="shareBtn">Share Link</button>
</div>

<script>
/* -------------------
   SNOWFLAKE ANIMATION
------------------- */
function createSnowflake() {
  const flake = document.createElement("div");
  flake.className = "snowflake";
  flake.textContent = "â„";
  const size = Math.random() * 1.2 + 0.8;
  flake.style.fontSize = size + "rem";
  flake.style.left = Math.random() * 100 + "vw";
  const duration = Math.random() * 5 + 5;
  flake.style.animationDuration = duration + "s";
  document.body.appendChild(flake);
  setTimeout(() => flake.remove(), duration * 1000);
}
setInterval(createSnowflake, 120);

/* ---------------------------
   CHECKLIST + LOCALSTORAGE
--------------------------- */
const listContainer = document.getElementById("list-container");
const newItem = document.getElementById("newItem");

// iPhone-friendly localStorage fallback
function safeLocalStorageSet(key, value) {
  try { localStorage.setItem(key, value); } 
  catch { console.log("localStorage not available"); }
}
function safeLocalStorageGet(key) {
  try { return localStorage.getItem(key); } 
  catch { return null; }
}

/* Load data from URL or localStorage */
function loadData() {
  const urlParams = new URLSearchParams(window.location.search);
  const encoded = urlParams.get("data");

  if (encoded) {
    try {
      const decoded = JSON.parse(atob(encoded));
      safeLocalStorageSet("checklist", JSON.stringify(decoded));
    } catch { console.log("Invalid share link"); }
  }

  const saved = JSON.parse(safeLocalStorageGet("checklist") || "[]");
  saved.forEach(addItemToPage);
}

/* Add item DOM element */
function addItemToPage(obj) {
  const div = document.createElement("div");
  div.className = "item";

  const check = document.createElement("input");
  check.type = "checkbox";
  check.checked = obj.checked;
  check.onchange = saveToLocal;

  const text = document.createElement("span");
  text.textContent = obj.text;

  const delBtn = document.createElement("button");
  delBtn.textContent = "Remove";
  delBtn.onclick = () => {
    div.remove();
    saveToLocal();
  };

  div.appendChild(check);
  div.appendChild(text);
  div.appendChild(delBtn);
  listContainer.appendChild(div);
}

/* Add new item */
function addNewItem(text) {
  if (!text.trim()) return;
  const obj = { text, checked: false };
  addItemToPage(obj);
  saveToLocal();
}

/* Save entire list to localStorage */
function saveToLocal() {
  const items = [];
  const itemDivs = document.querySelectorAll(".item");
  itemDivs.forEach(div => {
    items.push({
      text: div.querySelector("span").textContent,
      checked: div.querySelector("input").checked
    });
  });
  safeLocalStorageSet("checklist", JSON.stringify(items));
}

/* Generate shareable link */
function generateShareLink() {
  const data = safeLocalStorageGet("checklist") || "[]";
  const encoded = btoa(data);
  const link = window.location.origin + window.location.pathname + "?data=" + encoded;

  // iPhone-compatible copy
  const tempInput = document.createElement("input");
  document.body.appendChild(tempInput);
  tempInput.value = link;
  tempInput.select();
  tempInput.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(tempInput);

  alert("Link copied! Share it with others.");
}

/* Event listeners */
document.getElementById("addBtn").onclick = () => {
  addNewItem(newItem.value);
  newItem.value = "";
};
newItem.addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    addNewItem(newItem.value);
    newItem.value = "";
  }
});
document.getElementById("shareBtn").onclick = generateShareLink;

loadData();
</script>

</body>
</html>
